-- =====================================================
-- 02_insert_test_data.sql
-- Заполняет базу тестовыми данными для обновленной схемы
-- (без sub_dimensions, с рекурсивным dimensions)
-- =====================================================

-- 1. Добавляем модели в таблицу models
INSERT INTO models (model_name, description) VALUES
('Digital Maturity Model', 'Оценка цифровой зрелости компании'),
('COBIT', 'Модель управления корпоративными ИТ');

-- 2. Добавляем несколько измерений в таблицу dimensions
--    Пример: для модели с ID = 1 (Digital Maturity Model)
--    prev_level = NULL -> корневой уровень
INSERT INTO dimensions (model_id, dimension_name, description, prev_level) VALUES
(1, 'Strategy', 'Оценка стратегии', NULL),            -- dimension_id=1
(1, 'Technology', 'Оценка технологий', NULL),         -- dimension_id=2
(1, 'Innovation', 'Стратегия инноваций', 1),          -- dimension_id=3 (дочерняя для Strategy)
(1, 'Cloud Adoption', 'Использование облачных технологий', 2), -- dimension_id=4 (дочерняя для Technology)

--    Пример: для модели с ID = 2 (COBIT)
(2, 'Governance', 'Управление корпоративными ИТ', NULL); -- dimension_id=5

-- 3. Добавляем критерии (требования) в таблицу criteria
--    При вставке в 'recommendations' используем валидный JSON, к примеру '{}'
--    Далее мы обновим это поле корректными JSON-данными.
INSERT INTO criteria (dimension_id, criteria_text, level, recommendations) VALUES
(1, 'Эффективность управления портфелем', 4, '{}'),
(3, 'Наличие четкой стратегии инноваций', 5, '{}'),
(4, 'Процент использования облачных технологий', 4, '{}'),
(5, 'IT Risk Management', 4, '{}');

-- 4. Обновляем поле recommendations JSON для уточнения рекомендаций по уровням
--    Теперь, когда в поле хранится '{}', можно безопасно выполнять UPDATE
UPDATE criteria
SET recommendations = '{
    "1": "Создайте базовый план управления портфелем.",
    "2": "Обучите сотрудников основам управления проектами.",
    "3": "Проводите регулярные аудиты эффективности.",
    "4": "Используйте ПО для управления портфелем.",
    "5": "Применяйте лучшие практики и делитесь опытом."
}'
WHERE dimension_id = 1;  -- Для 'Эффективность управления портфелем'

UPDATE criteria
SET recommendations = '{
    "1": "Сформулируйте инновационную стратегию и цели.",
    "2": "Организуйте мозговой штурм для сбора идей.",
    "3": "Внедрите процессы отбора инноваций.",
    "4": "Пересматривайте стратегию на основе новых данных.",
    "5": "Расширяйте масштабы инновационных проектов."
}'
WHERE dimension_id = 3;  -- Для 'Наличие четкой стратегии инноваций'

UPDATE criteria
SET recommendations = '{
    "1": "Оцените текущую ИТ-инфраструктуру.",
    "2": "Начните с миграции незначительных данных.",
    "3": "Обучите сотрудников облачным технологиям.",
    "4": "Оптимизируйте использование облака.",
    "5": "Полностью интегрируйте облачные решения в бизнес-процессы."
}'
WHERE dimension_id = 4;  -- Для 'Процент использования облачных технологий'

UPDATE criteria
SET recommendations = '{
    "1": "Идентифицируйте ключевые IT-риски и создайте базовый регистр.",
    "2": "Определите контрольные точки по стандартам COBIT.",
    "3": "Периодически пересматривайте риски и обновляйте планы.",
    "4": "Внедрите автоматизированные системы мониторинга.",
    "5": "Достигните зрелой практики управления рисками."
}'
WHERE dimension_id = 5;  -- Для 'IT Risk Management'
